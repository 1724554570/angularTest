angular.module("testApp").controller("loginController",["$scope","cookie",function(e,r){e.titles="用户管理";var o=angular.fromJson(window.localStorage.getItem("login.users"));e.isLogin=o||angular.fromJson(r.get("login.users.name"))||"",e.verify=function(){var e=$(".verifyimg").attr("src");e.indexOf("?")>0?$(".verifyimg").attr("src",e+"&random="+Math.random()):$(".verifyimg").attr("src",e.replace(/\?.*$/,"")+"?"+Math.random())}}]).controller("loginIndexController",["$scope","cookie","loginService","localStorage","deviceService","userInfoService",function(e,r,o,s,t,n){e.reg=/^1[0-9]{10}$/,e.login={mobile_no:"",password:"",passwordInit:"%&@(!^$)",verify:"",rememberPassword:!0,isFirstLogin:!1},e.gototop=function(){$("body,html").scrollTop(0)},e.init=function(){e.gototop(),null==window.localStorage.getItem("rememberPassword")||void 0==window.localStorage.getItem("rememberPassword")||"true"===window.localStorage.getItem("rememberPassword")?e.rememberPassword=!0:e.rememberPassword=window.localStorage.getItem("rememberPassword"),e.login.rememberPassword?(e.isFirstLogin=!1,e.login.password=window.localStorage.getItem("password"),e.login.mobile_no=window.localStorage.getItem("mobile_no")):e.isFirstLogin=!0},e.init(),e.getLoginError=function(r){if("string"==typeof r)return void alert(r);for(var o in r)e.login[o+"error"]=!0,alert(r[o][0])},e.error={loginPassMsg:""},e.checkLoginPassCaps=function(r){var s=o.checkCapsLock(r);return s?void(e.error.loginPassMsg="大写锁定键被按下，请注意大小写"):void(e.error.loginPassMsg="")},e.clearTip=function(r){e.error[r]=""},e.loginconfirm=function(){var o="";o=e.login.password;var i={mobile_no:e.login.mobile_no,password:o,token:token.token,rememberMe:e.login.rememberPassword,device:t.device};n.getLogin(i,function(t){if(1===t.data.status){e.rememberPassword===!0||"true"===e.rememberPassword?(window.localStorage.setItem("password",o),window.localStorage.setItem("mobile_no",t.data.users.username)):window.localStorage.removeItem("password"),s.setValue("rememberPassword",e.rememberPassword);var n=angular.toJson(t.data.users);r.set("isLogined",t.data.users.username,604800,!0),s.setValue("login.users",n),window.location.href=base.domain+"/#/app/home"}else e.login.mobile_no="",e.login.password="",e.getLoginError(t.data.message)})};var i=window.localStorage.getItem("username");e.login.mobile_no=i?i:""}]).controller("registerController",["$scope","$state","loginService","userInfoService",function(e,r,o,s){e.reg=/^1[0-9]{10}$/,e.register={},e.register.mobile_no="",e.register.password="",e.register.invitation="",e.register.invitationerror=!1,e.getVCodeAbleed=!0,e.getError=function(r){if("string"==typeof r)return void alert(r);for(var o in r)e.register[o+"error"]=!0,alert(r[o][0])},e.error={regPassMsg:""},e.checkRegPassCaps=function(r){var s=o.checkCapsLock(r);return s?void(e.error.regPassMsg="大写锁定键被按下，请注意大小写"):void(e.error.regPassMsg="")},e.clearTip=function(r){e.error[r]=""},e.confirm=function(o){if(""==e.register.password||void 0==e.register.password)return void alert("密码不能为空！");token.token="register";var t={mobile_no:e.register.mobile_no,verifyCode:e.register.verifyCode,password:e.register.password,token:token.token};s.getRegister(t,function(o){1===o.data.status?(window.localStorage.setItem("username",e.register.mobile_no),r.go("login.loginindex")):e.getError(o.data.message)})}}]).controller("forgetPasswordController",["$scope","cookie","userInfoService",function(e,r,o){e.reg=/^1[0-9]{10}$/,e.resetPassword={},e.resetPassword.mobile_no="",e.resetPassword.password="",e.confirm=function(){var s={mobile_no:e.resetPassword.mobile_no,password:e.resetPassword.password,token:token.token};o.getForget(s,function(o){1===o.data.status?r.set("login.mobile_no",e.resetPassword.mobile_no,604800,!0):e.getError(o.data.message)})},e.getError=function(e){console.log(e)}}]),angular.module("testApp").factory("loginService",function(){var e={};return e.isIE=function(){return navigator.userAgent.indexOf("MSIE")>0&&navigator.userAgent.indexOf("MSIE 9.0")>0},e.checkCapsLock=function(e){if(!this.isIE()){var r=e||window.event,o=r.keyCode||r.which,s=r.shiftKey||16==o||!1;return!!(o>=65&&o<=90&&!s||o>=97&&o<=122&&s)}},e});