angular.module("testApp").controller("loginController",["$scope","$http","$sce","$state","$document","cookie",function(e,o,r,t,s,n){e.titles="用户管理";var i=angular.fromJson(window.localStorage.getItem("login.users"));e.isLogin=i||angular.fromJson(n.get("login.users.name"))||""}]).controller("loginIndexController",["$scope","$http","$timeout","$state","cookie","loginService","localStorage","$interval","deviceService","userInfoService",function(e,o,r,t,s,n,i,a,g,l){e.reg=/^1[0-9]{10}$/,e.login={},e.login.mobile_no="",e.login.password="",e.login.passwordInit="%&@(!^$)",e.rememberPassword=!0,e.isFirstLogin=!1,e.gototop=function(){$("body,html").scrollTop(0)},e.init=function(){e.gototop(),null==window.localStorage.getItem("rememberPassword")||void 0==window.localStorage.getItem("rememberPassword")||"true"===window.localStorage.getItem("rememberPassword")?e.rememberPassword=!0:e.rememberPassword=window.localStorage.getItem("rememberPassword"),e.login.rememberPassword?(e.isFirstLogin=!1,e.login.password=e.login.passwordInit):e.isFirstLogin=!0},e.init(),e.getLoginError=function(o){if("string"==typeof o)return void alert(o);for(var r in o)e.login[r+"error"]=!0,alert(o[r][0])},e.error={loginPassMsg:""},e.checkLoginPassCaps=function(o){var r=n.checkCapsLock(o);return r?void(e.error.loginPassMsg="大写锁定键被按下，请注意大小写"):void(e.error.loginPassMsg="")},e.clearTip=function(o){e.error[o]=""},e.loginconfirm=function(){var o="";o=e.login.password;var r={mobile_no:e.login.mobile_no,password:o,token:token.token,rememberMe:e.login.rememberPassword,device:g.device};l.getLogin(r,function(o){if(1===o.data.status){e.rememberPassword===!0||"true"===e.rememberPassword?window.localStorage.setItem("password",o.data.users.userpass):window.localStorage.removeItem("password"),i.setValue("rememberPassword",e.rememberPassword);var r=angular.toJson(o.data.users);s.set("isLogined",o.data.users.username,604800,!0),i.setValue("login.users",r),window.location.href=base.domain+"/#/app/home"}else e.login.mobile_no="",e.login.password="",e.getLoginError(o.data.message)})};var d=window.localStorage.getItem("username");e.login.mobile_no=d?d:""}]).controller("registerController",["$scope","$http","$timeout","$state","cookie","loginService","localStorage","$interval","userInfoService",function(e,o,r,t,s,n,i,a,g){e.reg=/^1[0-9]{10}$/,e.register={},e.register.mobile_no="",e.register.password="",e.register.invitation="",e.register.invitationerror=!1,e.getVCodeAbleed=!0,e.getError=function(o){if("string"==typeof o)return void alert(o);for(var r in o)e.register[r+"error"]=!0,alert(o[r][0])},e.error={regPassMsg:""},e.checkRegPassCaps=function(o){var r=n.checkCapsLock(o);return r?void(e.error.regPassMsg="大写锁定键被按下，请注意大小写"):void(e.error.regPassMsg="")},e.clearTip=function(o){e.error[o]=""},e.confirm=function(o){if(""==e.register.password||void 0==e.register.password)return void alert("密码不能为空！");token.token="register";var r={mobile_no:e.register.mobile_no,verifyCode:e.register.verifyCode,password:e.register.password,token:token.token};g.getRegister(r,function(o){1===o.data.status?(window.localStorage.setItem("username",e.register.mobile_no),t.go("login.loginindex")):e.getError(o.data.message)})}}]).controller("forgetPasswordController",["$scope","$http","$interval","$state","cookie","localStorage","loginService","userInfoService",function(e,o,r,t,s,n,i,a){e.reg=/^1[0-9]{10}$/,e.resetPassword={},e.resetPassword.mobile_no="",e.resetPassword.password="",e.confirm=function(){var o={mobile_no:e.resetPassword.mobile_no,password:e.resetPassword.password,token:token.token};a.getForget(o,function(o){1===o.data.status?s.set("login.mobile_no",e.resetPassword.mobile_no,604800,!0):e.getError(o.data.message)})},e.getError=function(e){console.log(e)}}]),angular.module("testApp").factory("loginService",function(){var e={};return e.isIE=function(){return navigator.userAgent.indexOf("MSIE")>0&&navigator.userAgent.indexOf("MSIE 9.0")>0},e.checkCapsLock=function(e){if(!this.isIE()){var o=e||window.event,r=o.keyCode||o.which,t=o.shiftKey||16==r||!1;return!!(r>=65&&r<=90&&!t||r>=97&&r<=122&&t)}},e});